# 메뉴관리시스템 갭 분석 결과

## 개요
- **분석 대상**: 메뉴관리시스템
- **분석일**: 2026-02-20
- **Design 문서**: `docs/02-design/features/1-20260220-메뉴관리시스템_재편.design.md`

## 종합 결과

| 카테고리 | 매치율 | 상태 |
|----------|:------:|:----:|
| API 엔드포인트 | 100% | ✅ |
| DB 스키마 | 100% | ✅ |
| 컴포넌트 구조 | 60% | ❌ |
| 에러 처리 | 75% | ⚠️ |
| **종합** | **72%** | **⚠️** |

---

## 1. API 엔드포인트 (100% ✅)

| Design | 구현 | 상태 |
|--------|------|:----:|
| `GET /api/main-menus` (공개) | `public-routes.ts` L100 | ✅ |
| `GET /api/admin/main-menus` | `admin-routes.ts` L3450 | ✅ |
| `POST /api/admin/main-menus` | `admin-routes.ts` L3461 | ✅ |
| `PATCH /api/admin/main-menus/:id` | `admin-routes.ts` L3516 | ✅ |
| `DELETE /api/admin/main-menus/:id` | `admin-routes.ts` L3552 | ✅ |
| `PATCH /api/admin/main-menus/reorder` | `admin-routes.ts` L3494 | ✅ |

> 추가 수정: `image.ts`의 `/:id` catch-all 라우트에서 `next()` → `next('route')` 변경으로 라우트 충돌 해결

---

## 2. DB 스키마 (100% ✅)

| Design | 구현 | 상태 |
|--------|------|:----:|
| `main_menus` 테이블 | `shared/schema.ts` L799~814 | ✅ |
| `id`, `menuId`, `title`, `icon`, `path` | 완전 일치 | ✅ |
| `homeType`, `homeSubmenuPath` | 완전 일치 | ✅ |
| `isActive`, `order`, `createdAt`, `updatedAt` | 완전 일치 | ✅ |
| `service_items.mainMenuId` FK 추가 | L841 | ✅ |
| `mainMenusRelations` | L860~862 | ✅ |
| `serviceItemsRelations.mainMenu` | L854~857 | ✅ |
| 초기 seed 데이터 (5개 메뉴) | `seed-main-menus.ts` | ✅ |

---

## 3. 컴포넌트 구조 (60% ❌)

### ✅ 구현 완료

| Design | 구현 | 상태 |
|--------|------|:----:|
| `MenuManagement.tsx` 기본 컴포넌트 | `components/admin/MenuManagement.tsx` | ✅ |
| 아코디언 형태 메뉴 목록 | 구현됨 | ✅ |
| 활성/비활성 토글 | Switch 컴포넌트 사용 | ✅ |
| 메뉴 수정 다이얼로그 (제목, 아이콘, 경로) | Dialog 구현 | ✅ |
| 홈 설정 다이얼로그 | Dialog 구현 | ✅ |
| `useMainMenus` 커스텀 훅 | `hooks/useMainMenus.ts` | ✅ |
| `BottomNavigation.tsx` 동적 메뉴 | API 기반 렌더링 | ✅ |
| `App.tsx` 동적 경로 판별 | `useMainMenus` 연동 | ✅ |
| 정적 폴백 데이터 | `MAIN_PAGE_PATHS` + 폴백 배열 | ✅ |
| `admin.tsx`에 메뉴관리 탭 추가 | 첫 번째 탭으로 추가 | ✅ |

### 🔴 누락 (Design ○, 구현 ✗)

| 항목 | Design 명세 | 현재 상태 |
|------|------------|-----------|
| **admin.tsx 탭 통합 (10→5)** | 채팅메뉴, 이미지생성, 음악프롬프트, 미션시스템, 포토북, UI콘텐츠 → `menu-management` 안에 통합 | 기존 10개 탭 유지 + 메뉴관리만 추가 (총 11개) |
| **드래그 정렬** | 메뉴 순서를 드래그로 변경 | GripVertical 아이콘만 있고, 드래그 기능 미구현 |
| **하위메뉴 관리 패널** | `<ServiceItemManagement mainMenuId={N} />` 각 메뉴별 렌더링 | 미구현 |
| **`MenuHomeSettingDialog.tsx`** 별도 파일 | Design에서 별도 파일로 명시 | `MenuManagement.tsx` 내부에 인라인으로 구현 (기능 동일) |
| **`App.tsx` `getSectionTitle()` 동적화** | DB 메뉴 기반으로 헤더 제목 변경 | 하드코딩 유지 |

### 🟢 추가 (Design ✗, 구현 ○)

| 항목 | 설명 |
|------|------|
| 관련 관리 기능 바로가기 | `MenuManagement`에서 각 메뉴별 관련 관리 탭으로 이동하는 링크 버튼 |

---

## 4. 에러 처리 (75% ⚠️)

| Design | 구현 | 상태 |
|--------|------|:----:|
| API 로딩 실패 → 정적 폴백 | `useMainMenus` 훅에서 폴백 배열 사용 | ✅ |
| 중복 menuId → 409 | `admin-routes.ts` L3472 | ✅ |
| 메뉴 미존재 → 404 | `PATCH /:id`, `DELETE /:id`에서 미구현 | 🔴 |
| 홈 설정 오류 → 400 | 별도의 400 벨리데이션 미구현 | 🔴 |

---

## 권장 조치

### 우선순위 높음 (종합 매치율 개선 필수)
1. **admin.tsx 탭 재편 (10→5)**: 채팅, 이미지, 음악, 미션, 포토북, UI콘텐츠 탭을 `menu-management` 내부로 통합
2. **`App.tsx` `getSectionTitle()` 동적화**: DB 메뉴 기반으로 헤더 제목 변경

### 우선순위 중간 (품질 개선)
3. **에러 처리 보완**: PATCH/DELETE에서 메뉴 미존재 시 404 반환
4. **홈 설정 벨리데이션**: homeType='submenu'인데 homeSubmenuPath 누락 시 400 반환

### 우선순위 낮음 (추후 구현)
5. **드래그 정렬 기능**: `@dnd-kit` 등 라이브러리 사용
6. **하위메뉴 관리 패널**: `ServiceItemManagement`에 `mainMenuId` prop 전달

---

## 다음 단계

- 종합 매치율 **72%** → 주요 갭 해결 후 `/check 메뉴관리시스템` 재실행 권장
- **핵심 갭**: admin.tsx 탭 10→5 통합, getSectionTitle 동적화
- 이 2건 해결 시 예상 매치율: **88~90%**
