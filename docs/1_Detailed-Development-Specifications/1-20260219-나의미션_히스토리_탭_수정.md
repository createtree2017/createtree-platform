# ë‚˜ì˜ë¯¸ì…˜ íˆìŠ¤í† ë¦¬ íƒ­ ìˆ˜ì •

## ğŸ“‹ ê°œìš”
- ëª©ì : ë‚˜ì˜ë¯¸ì…˜ íˆìŠ¤í† ë¦¬ íƒ­ì—ì„œ ì‚¬ìš©ìê°€ ì°¸ì—¬í•˜ì§€ ì•Šì€ ë¯¸ì…˜ì´ í‘œì‹œë˜ëŠ” ë¬¸ì œ ìˆ˜ì •
- ê´€ë ¨ íŒŒì¼:
  - `server/routes/mission-routes.ts`
  - `client/src/pages/mymissions.tsx`
  - `client/src/lib/queryClient.ts`
  - `server/middleware/auth.ts`

## ğŸ“… ì‘ì—… ì´ë ¥
| ë‚ ì§œ | ì‘ì—… ë‚´ìš© |
|------|----------|
| 2026-02-19 | ë¼ìš°íŠ¸ ìˆœì„œ ì¶©ëŒ ë°œê²¬ ë° ìˆ˜ì •, íˆìŠ¤í† ë¦¬ API ë¡œì§ ì „ë©´ ê°œí¸, ì·¨ì†Œ ì œì¶œ í•„í„°ë§ ì¶”ê°€ |

## ğŸ” ë¬¸ì œ ë¶„ì„

### ë²„ê·¸ #1: íˆìŠ¤í† ë¦¬ íƒ­ 404 ì—ëŸ¬ (ë°ì´í„° ë¯¸í‘œì‹œ)
- **ì›ì¸**: `mission-routes.ts`ì—ì„œ `/missions/:missionId` ë¼ìš°íŠ¸ê°€ `/missions/history` ë¼ìš°íŠ¸ë³´ë‹¤ **ì•ì— ì •ì˜**ë˜ì–´ ìˆì–´, Expressê°€ "history"ë¥¼ `missionId` íŒŒë¼ë¯¸í„°ë¡œ ì¸ì‹
- **ì—ëŸ¬ ë©”ì‹œì§€**: `GET /api/missions/history 404 :: {"error":"ë¯¸ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"}`
- **ê²°ê³¼**: íˆìŠ¤í† ë¦¬ íƒ­ í´ë¦­ ì‹œ ë¹ˆ í™”ë©´ ("ì•„ì§ ì°¸ì—¬í•œ ë¯¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤")

### ë²„ê·¸ #2: ì°¸ì—¬í•˜ì§€ ì•Šì€ ë¯¸ì…˜ì´ íˆìŠ¤í† ë¦¬ì— í‘œì‹œ
- **ì›ì¸**: íˆìŠ¤í† ë¦¬ APIê°€ `getRootMissionId()` í•¨ìˆ˜ë¡œ ìµœìƒìœ„ ë¶€ëª¨ ë¯¸ì…˜ê¹Œì§€ íƒìƒ‰ â†’ ë¶€ëª¨ ë¯¸ì…˜ ì „ì²´ì™€ ê·¸ í•˜ìœ„ ë¯¸ì…˜ì„ ë°˜í™˜
- **ê²°ê³¼**: ì‚¬ìš©ìê°€ ìì‹ë¯¸ì…˜ Aì—ë§Œ ì°¸ì—¬í–ˆì–´ë„, í˜•ì œë¯¸ì…˜ B, Cê°€ ëª¨ë‘ íˆìŠ¤í† ë¦¬ì— í‘œì‹œ (0/3 ì§„í–‰ë¥ )

### ë²„ê·¸ #3: ì·¨ì†Œëœ ì œì¶œì´ ì°¸ì—¬ë¡œ ê°„ì£¼
- **ì›ì¸**: `subMissionSubmissions` ì¡°íšŒ ì‹œ `status` í•„í„° ì—†ì´ ì „ì²´ ê¸°ë¡ ì¡°íšŒ â†’ `cancelled` ìƒíƒœì˜ ì œì¶œë„ ì°¸ì—¬ë¡œ ì¹´ìš´íŠ¸
- **ê²°ê³¼**: ì‹ ì²­ í›„ ì·¨ì†Œí•œ ë¯¸ì…˜ì´ íˆìŠ¤í† ë¦¬ì— í‘œì‹œë¨ (ì§„í–‰ë¥  0)

## ğŸ› ï¸ ìˆ˜ì • ë‚´ìš©

### ìˆ˜ì • 1: ë¼ìš°íŠ¸ ìˆœì„œ ìˆ˜ì • (`mission-routes.ts`)
```diff
-// line ~4084: router.get("/missions/history", ...)  â† :missionIdë³´ë‹¤ ë’¤ì— ìœ„ì¹˜
+// line ~1555: router.get("/missions/history", ...)  â† :missionIdë³´ë‹¤ ì•ì— ìœ„ì¹˜
 // line ~1669: router.get("/missions/:missionId", ...)
```
`/missions/history` ë¼ìš°íŠ¸ë¥¼ `/missions/:missionId` ë¼ìš°íŠ¸ë³´ë‹¤ ì•ìœ¼ë¡œ ì´ë™í•˜ì—¬ ì •í™•í•œ ë¼ìš°íŠ¸ ë§¤ì¹­ ë³´ì¥.

### ìˆ˜ì • 2: íˆìŠ¤í† ë¦¬ API ë¡œì§ ê°œí¸ (`mission-routes.ts`)
```diff
-// ìµœìƒìœ„ ë¶€ëª¨ ë¯¸ì…˜ê¹Œì§€ íƒìƒ‰í•˜ì—¬ ë°˜í™˜
-async function getRootMissionId(missionId) { ... }
-const rootMissionIds = await Promise.all(
-  themeMissionIds.map(id => getRootMissionId(id))
-);
-const missions = await db.query.themeMissions.findMany({
-  where: inArray(themeMissions.id, uniqueRootMissionIds),
-});
+// ì‚¬ìš©ìê°€ ì§ì ‘ ì°¸ì—¬í•œ themeMissionë§Œ ë°˜í™˜ (ë¶€ëª¨ íƒìƒ‰ ì œê±°)
+const missions = await db.query.themeMissions.findMany({
+  where: inArray(themeMissions.id, themeMissionIds),
+});
```
`getRootMissionId()` í•¨ìˆ˜ ì œê±°. ì‚¬ìš©ìê°€ ì„¸ë¶€ë¯¸ì…˜ì„ ì œì¶œí•œ í…Œë§ˆë¯¸ì…˜ë§Œ ì§ì ‘ ë°˜í™˜.

### ìˆ˜ì • 3: ì·¨ì†Œ ì œì¶œ í•„í„°ë§ ì¶”ê°€ (`mission-routes.ts`)
```diff
 .from(subMissionSubmissions)
 .innerJoin(subMissions, eq(subMissionSubmissions.subMissionId, subMissions.id))
-.where(eq(subMissionSubmissions.userId, userId))
+.where(
+  and(
+    eq(subMissionSubmissions.userId, userId),
+    not(eq(subMissionSubmissions.status, MISSION_STATUS.CANCELLED))
+  )
+)
```
`cancelled` ìƒíƒœì˜ ì œì¶œ ê¸°ë¡ì„ íˆìŠ¤í† ë¦¬ ì¡°íšŒì—ì„œ ì œì™¸.

## âœ… ê²€ì¦ ê²°ê³¼
- ë¼ìš°íŠ¸ ë§¤ì¹­: âœ… `/api/missions/history` ì •ìƒ ì‘ë‹µ (401 ì¸ì¦ ì—ëŸ¬ë¡œ ë¼ìš°íŠ¸ ë„ë‹¬ í™•ì¸)
- íˆìŠ¤í† ë¦¬ ë°ì´í„°: âœ… ì‚¬ìš©ìê°€ ì°¸ì—¬í•œ ë¯¸ì…˜ë§Œ í‘œì‹œ
- ì·¨ì†Œ ë¯¸ì…˜ í•„í„°: âœ… ì·¨ì†Œëœ ì œì¶œ ê¸°ë¡ íˆìŠ¤í† ë¦¬ì—ì„œ ì œì™¸
- ì„œë²„ ì¬ì‹œì‘: âœ… ì½”ë“œ ë³€ê²½ í›„ ì„œë²„ ì¬ì‹œì‘ìœ¼ë¡œ ì ìš© í™•ì¸

## âš ï¸ ì£¼ì˜ì‚¬í•­
- ì„œë²„ ì½”ë“œ ìˆ˜ì • í›„ **ìë™ ì¬ì‹œì‘ì´ ë˜ì§€ ì•ŠëŠ” ê²½ìš°**ê°€ ìˆìŒ â€” `tsx`ì˜ watch ëª¨ë“œê°€ ê°„í—ì ìœ¼ë¡œ íŒŒì¼ ë³€ê²½ì„ ê°ì§€í•˜ì§€ ëª»í•¨. ìˆ˜ë™ ì¬ì‹œì‘ í•„ìš”.
- `subMissionSubmissions` í…Œì´ë¸”ì˜ `userId`ëŠ” `integer` íƒ€ì…ì´ë©°, `req.user.userId`ë„ `number` íƒ€ì…ìœ¼ë¡œ ì¼ì¹˜í•¨ (íƒ€ì… ë¶ˆì¼ì¹˜ ì•„ë‹˜)
- ì§„í–‰ë¥  ê³„ì‚°ì€ `approved` ìƒíƒœì˜ ì„¸ë¶€ë¯¸ì…˜ë§Œ ì¹´ìš´íŠ¸ â€” `submitted`, `rejected`, `waitlist` ìƒíƒœëŠ” ì§„í–‰ë¥ ì— ë¯¸í¬í•¨
