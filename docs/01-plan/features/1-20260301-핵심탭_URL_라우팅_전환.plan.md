# 핵심 탭 URL 라우팅 기반 상태 관리 리팩토링 계획서

## 개요

- **기능명**: 핵심 탭 URL 라우팅 기반(`?tab=`) 전환 및 History Bloat 완화 리팩토링
- **작성일**: 2026-03-01
- **목표**: 안드로이드(Capacitor) 하드웨어 메뉴 뒤로가기의 완벽한 동작을 보장하기 위해, 앱/웹 전역에 있는 주요 컴포넌트들의 로컬 탭 상태(`useState`)를 URL 쿼리 파라미터 기반 라우팅으로 전환한다.

## 배경

- 최근 구축한 "뒤로가기 중앙 통제소"는 **모달창이나 팝업 시트를 끄는 것엔 강력하게 동작**하지만, 뒤에 깔린 넓은 화면 안에서의 **구역 이동(A 탭 -> B 탭)**은 URL 주소가 바뀌지 않다 보니, 뒤로가기 처리가 되지 않아 네이티브 앱 같은 UX를 제공하는 데 구멍(`Hole`)으로 남아있음.
- 앱 환경의 사용자에게 "페이지 이동 없이 탭만 바꿨더라도 뒤로가기 버튼을 누르면 이전 화면 탭으로 되돌려주는" 완벽한 역방향 경험(Deep Link / History Back)을 제공해야 함.
- 무분별한 뒤로가기 기록이 쌓여 메인 홈으로 나갈 수 없는 "히스토리 지옥(History Bloat)" 현상을 막기 위해 정교한 `replaceState` 설계가 동반되어야 함.

## 범위

### (1) 리팩토링 대상 (우선순위 순)

전부 바꾸는 것이 아니라 덩치가 크고 체류 시간이 긴 "핵심 관문"만 최우선으로 선별합니다.

1.  **관리자 페이지 (`admin.tsx`) 계층 구조**
    - `menu-management`, `member-management` 등의 최상단 메인 탭 5종류.
    - 그 안의 `admin.tsx` 내 하위 탭들 (예: 회원관리 -> 병원관리).
    - `MenuManagement.tsx`가 품고 있는 무수히 많은 인라인 서브 탭들 (예: 문화센터 -> 미션관리).
2.  **(선택) 모바일 하단 네비게이션 탭 (메인 프론트엔드)**
    - 모바일 사용자 진입점인 `문화센터`, `이미지센터`, `갤러리` 등의 탭 이동도 `window.history` 기반으로 동작하도록 보정 (현재는 URL 구조를 이미 띄고 있을 확률이 높으나, popstate 이벤트 및 replace 전략 최적화 필요).

### (2) 제외 (단순 UI 스테이트)

- 게시물 내의 간단한 "상세보기/코멘트" 전환 스위치.
- 아코디언 컴포넌트(`Accordion`)의 열기/닫기 개별 상태 (라우팅 불필요).

## 기술적 해결 방안 (How-to)

### 1. URL 쿼리 스트링(`?tab=...&sub=...`) 구조의 표준화

기존의 `activeTab` 같은 상태 변수를 `window.location.search` 또는 `URLSearchParams`를 파싱하여 값을 가져오는 순수 함수(또는 커스텀 훅 `useTabQuery`)로 완전히 교체합니다.

### 2. History Bloat(뒤로가기 지옥) 방어 로직 (`pushState` vs `replaceState`)

핵심은 탭을 누르는 행위를 브라우저 세션 역사에 어떻게 기록하느냐입니다.

- **[A 패턴] 첫 진입 / 큰 맥락 변경 (pushState 사용)**
  - 예: 관리자로 진입해서 "회원관리" 메뉴를 완전 처음 눌러서 들어갈 때. 새로운 기능이므로 뒤로 가기를 위해 남김.
- **[B 패턴] 빈번한 자잘한 탭 탐색 반복 (replaceState 사용)**
  - 예: "회원관리"에 들어온 후 병원 탭 눌렀다가 유저 탭 눌렀다가 왔다 갔다 구경할 때.
  - 이 탐색 기록은 10개를 남겨봤자 뒤로가기 10번만 힘들게 만들 뿐임. 따라서 현재 주소 자체를 덮어써서(Replace), 나중에 뒤로 가기 1번만 누르면 아예 뒤의 큰 문맥으로 돌아가게 방어 설계함.

### 3. 새로고침/DeepLink 보존

URL 자체에 상태(`?tab=culture-center&sub=mission-categories`)가 명확히 명시되므로 사용자가 PC에서 새로고침(F5) 하거나 관리자끼리 카카오톡으로 주소를 공유해도 정확히 그 탭 화면이 출력됨을 보장합니다.

## 예상 일정 및 영향도

- **예상 작업량**: 약 1일 (현존하는 거대 컴포넌트 `admin.tsx`, `MenuManagement.tsx` 위주 해체 및 조립)
- **영향 범위**: 모든 탭 이동 동작의 기준점. 뒤로가기 중앙 모듈과 맞물리면서 폭발적인 사용성 개선 예상.

## 다음 단계

→ 해당 Plan 검토 완료 후, 대상 파일(`admin.tsx`, `MenuManagement.tsx`)을 수정하는 구현(Do) 및 `/design` 스펙 업데이트 단계를 즉시 진행합니다.
