# 메뉴 관리 시스템 재편 계획서

## 개요
- **기능명**: 메뉴관리시스템
- **작성일**: 2026-02-20
- **목표**: (1) `admin.tsx` 5063줄 단일 파일을 컴포넌트별로 분리하고, (2) 관리자 메뉴 구조를 사용자 메뉴와 일치하도록 재편하며, (3) 메인 메뉴 DB 관리 + 홈 설정 기능을 추가

## 배경
- `admin.tsx`에 17개 컴포넌트가 단일 파일에 혼재 (5063줄) → 유지보수/빌드 성능/Git 충돌 문제
- 이미 `components/admin/`에 27개 파일이 분리되어 있어 일관성 불일치
- 관리자 탭 10개가 사용자 메뉴 구조와 불일치
- 메뉴 공개/비공개, 홈 설정은 코드 수정으로만 가능

---

## 현재 → 새 구조 매핑

### 관리자 탭 재편 (10개 → 5개)

| 현재 탭 | 새 위치 |
|---------|---------|
| 채팅 메뉴 | 메뉴관리 > AI생성 > 채팅시스템관리 |
| 이미지 생성 | 메뉴관리 > AI생성 > 이미지생성관리 |
| 음악 프롬프트 | 메뉴관리 > AI생성 > 음악생성관리 |
| 미션 시스템 | 메뉴관리 > 나의미션 > 미션관리 |
| 포토북 관리 | 메뉴관리 > AI생성 > 포토북관리 |
| UI 컨텐츠 관리 | 메뉴관리 > AI생성 (페이지관리 + 하위메뉴 분산) |
| 회원관리 | 유지 |
| 시스템 설정 | 유지 |
| 마일스톤 | 뒤쪽 유지 (미사용) |
| 언어 설정 | 뒤쪽 유지 (미사용) |

### 새 관리자 탭 순서
```
[ 메뉴관리 ] [ 회원관리 ] [ 시스템설정 ] [ 마일스톤 ] [ 언어설정 ]
```

### 메뉴관리 탭 내부 구조

```
📋 메뉴관리
├── 🟡 나의미션 [활성/비활성] [🏠 홈 설정]
│     ├── 미션관리 (카테고리/액션타입/주제미션/검수대기/큰미션)
│     └── 하위메뉴관리 (컬렉션/히스토리)
├── 🟢 문화센터 [활성/비활성] [🏠 홈 설정]
│     └── 하위메뉴관리
├── 🔵 AI생성 [활성/비활성] [🏠 홈 설정]
│     ├── 페이지관리 (배너/메뉴카드/인기스타일/메인갤러리)
│     ├── 이미지생성관리 / 채팅시스템관리 / 음악생성관리 / 포토북관리
│     └── 하위메뉴관리 (아기얼굴/스냅사진/만삭/스타일/스티커/콜라주/AI채팅/음악/포토북)
├── 🟣 갤러리 [활성/비활성] [🏠 홈 설정]
│     └── 하위메뉴관리 (이미지갤러리/제작소갤러리)
└── 🟠 마이페이지 [활성/비활성] [🏠 홈 설정]
      └── 하위메뉴관리
```

---

## 범위

### 포함
1. **Phase 0 (최우선)**: `admin.tsx` 컴포넌트 분리 리팩토링
2. **Phase 1**: `main_menus` DB 테이블 + 마이그레이션
3. **Phase 2**: 메인 메뉴 CRUD API
4. **Phase 3**: 관리자 UI — 메뉴관리 탭 + 기존 탭 재배치
5. **Phase 4**: 프론트엔드 동적 네비게이션 (BottomNav, 헤더)

### 제외
- URL 경로명 변경 (별도 프로젝트)
- 새로운 하위 메뉴 페이지 개발
- 마일스톤/언어 설정 기능 자체 수정 (위치만 이동)

---

## 구현 단계

### ⭐ Phase 0: admin.tsx 컴포넌트 분리 (최우선 — 1일)

> [!IMPORTANT]
> 모든 후속 작업의 기반이 되는 핵심 리팩토링. 이것을 먼저 하지 않으면 5063줄 파일에서 탭 재편 작업이 극도로 위험함.

**현재 `admin.tsx`에 인라인으로 존재하는 17개 컴포넌트 → 별도 파일로 분리:**

| 분리 대상 (admin.tsx 내) | 줄 범위 | 크기 | → 새 파일 |
|------------------------|--------|------|----------|
| `PersonaManager` + `PersonaForm` | 978~1709 | ~731줄 | `PersonaManager.tsx` (덮어쓰기) |
| `CategoryManager` + `CategoryForm` | 1711~2037 | ~326줄 | `PersonaCategoryManager.tsx` |
| `ConceptCategoryManager` + `Form` | 2038~2363 | ~325줄 | `ConceptCategoryManager.tsx` (신규) |
| `ConceptManager` + `ConceptForm` + `VariableForm` | 2365~3732 | ~1367줄 | 기존 `ConceptManagement.tsx`와 병합 검토 |
| `ABTestManager` + `ABTestForm` | 3734~4259 | ~525줄 | `ABTestManager.tsx` |
| `ImageTester` | 4261~4641 | ~380줄 | `ImageTester.tsx` |
| `MusicStylePromptManager` | 4643~4795 | ~152줄 | `MusicStylePromptManager.tsx` |
| `ApplicationManagement` | 4797~5060 | ~263줄 | `ApplicationManagement.tsx` |
| `ImageGallery` (admin내부) | 207~493 | ~286줄 | `ImageGalleryAdmin.tsx` |

**분리 후 `admin.tsx`**: ~500줄 (AdminPage 메인 + import + 탭 레이아웃만)

**분리 원칙**:
- 기능 로직 변경 없이 **파일 이동만** 수행
- 각 컴포넌트는 import/export만 조정
- 분리 후 즉시 동작 확인 (dev 서버)

---

### Phase 1: DB 스키마 + 마이그레이션 (0.5일)

`main_menus` 테이블 신규 생성:
```
id, menuId, title, icon, path, 
homeType ('dedicated' | 'submenu'), homeSubmenuId,
isActive, order, createdAt, updatedAt
```

- `service_items`에 `mainMenuId` 필드 추가
- 초기 seed 데이터: 5개 메인 메뉴

---

### Phase 2: 백엔드 API (0.5일)

- `GET/POST/PUT/PATCH/DELETE /api/admin/main-menus` — 관리자 CRUD
- `GET /api/main-menus` — 프론트 네비게이션용 (활성 메뉴만)
- `service_items` API에 `mainMenuId` 필터 추가

---

### Phase 3: 관리자 UI — 메뉴관리 탭 + 탭 재편 (1~2일)

- 새 `MenuManagement` 컴포넌트 생성 (메뉴관리 탭 UI)
- 메인 메뉴별 활성/비활성 토글 + 홈 설정 UI
- `admin.tsx` 탭 구조 5개로 재편 (기존 컴포넌트 **import 위치만 변경**)

---

### Phase 4: 프론트엔드 — 동적 네비게이션 (0.5일)

- `BottomNavigation.tsx`: DB에서 활성 메뉴 목록 → 동적 렌더링
- `App.tsx`: `getSectionTitle()`, `MAIN_PAGE_PATHS` DB 기반 변경

---

## 영향 범위

| 파일 | 변경 유형 |
|------|----------|
| `admin.tsx` (5063줄) | **Phase 0 분리 + Phase 3 탭 재편** |
| `components/admin/*.tsx` (27+10 파일) | Phase 0 분리 대상 |
| `shared/schema.ts` | Phase 1 테이블 추가 |
| `server/routes.ts` 또는 `admin-routes.ts` | Phase 2 API 추가 |
| `BottomNavigation.tsx` | Phase 4 동적 변경 |
| `App.tsx` | Phase 4 헤더 로직 변경 |

> [!IMPORTANT]
> 기존 관리 컴포넌트 내부 로직은 변경하지 않습니다. Phase 0은 "파일 이동", Phase 3은 "import 위치 변경"이 핵심입니다.

## 예상 일정
- **Phase 0**: 1일 (최우선)
- **Phase 1~4**: 2~3일
- **총 예상**: 3~4일
- **우선순위**: 높음

## 검증 계획

### Phase 0 검증
- 분리 후 dev 서버 정상 구동 확인
- 각 관리 탭 접속 → 기존과 동일 동작 확인
- 빌드 에러 없음 확인

### Phase 3~4 검증
- 관리자: 메뉴 활성/비활성 토글 → 하단바 반영 확인
- 관리자: 홈 설정 변경 → 탭 클릭 시 올바른 페이지 이동 확인
- 사용자: 기존 기능 정상 작동 확인

## 다음 단계
→ Plan 승인 후 `/design 메뉴관리시스템`으로 설계 문서 작성
