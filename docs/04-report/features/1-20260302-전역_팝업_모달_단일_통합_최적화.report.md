# 전역 모달(Dialog/Sheet) 단일 통폐합 및 최적화 진행 현황 보고서 (Report)

**작업일자**: 2026-03-02
**작업자**: Antigravity Native (Agent)
**현재 상태**: **Phase 1 완료 및 브라우저 검증 통과** (다음 PC에서 Phase 2부터 이어서 진행 가능)

---

## 1. 작업 개요 및 변경 스펙

관리자(Admin) 및 사용자(User) 인터페이스 전역에 하드코딩된 약 60여 개의 이기종 로컬 상태(Local State) 팝업 모달들을 순수 컴포넌트 호출 방식인 `ModalContext` 단일 아키텍처로 통폐합하는 1단계 작업을 완료했습니다.

### 주요 달성 목표 (Phase 1)

- **비파괴 라우팅 적용**: 기존의 복잡한 쿼리 파라미터를 보존하면서, 팝업 렌더링 시 브라우저 히스토리 스택(URL 해시 앵커)만 안전하게 조작(`pushState`)하도록 `ModalContext.tsx` 코어 강화.
- **지역 Props Drilling 제거**: 모달 컴포넌트를 열 때 필요한 상태를 상위 부모(Dashboard)에서부터 끌고 내려오지 않고, `registerModal`에 등록된 식별표(ID) 하나만으로 여는 깔끔한 순수 텍스트 호출 구조 정립.

---

## 2. 세부 개발 내역 (Phase 1: 검수대기 팝업 시범 통합)

가장 복잡한 기능들이 얽혀 있는 **관리자 신청내역관리 -> 검수대기 목록**의 **'제출 내용 검수 팝업(`SubmissionDetailModal.tsx`)'**을 첫 번째 타겟으로 삼아 안전성 검증을 완료했습니다.

1. **`SubmissionDetailModal.tsx` 개조**
   - 스스로의 렌더링 상태(`isOpen`)와 닫기(`setIsOpen`) 권한을 포기하고, `Dialog open={true}`로 강제 고정하여 부모인 `ModalContext`의 통제(마운트/언마운트)에 100% 따르도록 개조.
2. **`MissionManagement.tsx` 코드 다이어트**
   - `<Dialog>` 하드코드 마크업 약 80라인 완전 삭제.
   - `selectedSubmission`, `reviewNotes` 등 지역 상태 변수(useState) 제거.
   - 모달을 열고 닫는 모든 콜백(`approveMutation`, `rejectMutation`)에서 지역 State 초기화 코드를 `modal.closeTopModal()`이라는 명시적 닫기 트리거로 전면 교체.

---

## 3. 🐛 크리티컬 이슈 트러블슈팅 내역 (인수인계 중요 포인트)

제가 디버깅을 진행하며 뼈저리게 겪었던 핵심 이슈들입니다. 다른 PC에서 남은 60여 개의 모달을 치환(Phase 2)할 때 **반드시 참고해야 할 교훈**입니다.

- **[이슈 1] 불필요한 import 및 중복 선언 에러 (JSX 파괴주의)**
  - **증상**: 코드의 블록 범위(Block Scope)를 잘못 예측하고 덮어씌워서 기존 함수(`approveMutation` 등)나 거대 렌더링 함수(`ReviewDashboard` 컴포넌트 마크업)가 통째로 유실 또는 중복되는 대참사 발생.
  - **해결**: `git diff`를 통해 손실된 코드를 추적하고 불필요한 중복 코드를 드러낸 후, 원본 함수를 찾아내어 모달 환경에 맞게(인수로 넘겨받는 형태) 섬세하게 수정함. 파일이 워낙 크고 복잡하므로 **코드 교체(Multi-Replace) 시 괄호의 계층을 극도로 유의해야 함**.
- **[이슈 2] 모달 레지스트리 렌더링 무반응 (제일 중요)**
  - **증상**: 코드를 완벽하게 컴파일(`Exit code: 0`) 했음에도 불구하고 브라우저에서 버튼을 누르면 아무런 반응이 없고 팝업이 안 열림.
  - **원인**: `MissionManagement.tsx`에서 모달을 띄울 때 `modal.openModal('submission-detail', SubmissionDetailModal, { props })` 형식으로 잘못된 식별자 대소문자와 불필요한 컴포넌트 인자를 집어넣음. 하지만 중앙 관제탑인 `ModalRegistry.tsx`에는 이미 과거버전 카멜케이스인 `'submissionDetail'` 이라는 식별표 하나만으로 컴포넌트가 매핑 등록(`registerModal`)되어 있었음.
  - **해결**: `openModal('submissionDetail', { ...props })` 규격으로 완벽 교정하여 해결.
  - **✅ Phase 2 작업 시 당부**: 모달을 통폐합할 때 **반드시 `modalRegistrations.ts` 파일에 해당 모달이 어떤 ID 문자열로 등록되어 있는지 먼저 100% 매칭 검증을 한 뒤 치환 작업을 진행할 것**.

---

## 4. 넥스트 스텝 (Phase 2 & Phase 3)

현재 코드베이스는 완벽하게 빌드 및 구동 가능한 무결점 상태입니다. 다른 PC에서 폴더를 열어 바로 아래의 작업을 이어가시면 됩니다.

1. **[진행 권장] Phase 2: 관리자(Admin) 지역 모달 연쇄 치환**
   - `MissionManagement.tsx` 외에도 `MenuManagement.tsx`, `GalleryManagement.tsx` 등 곳곳에 흩어져 있는 나머지 약 50여 개의 `<Dialog>`, `<Sheet>` 마크업 파괴 및 분리.
   - `useModalContext()` 이관 및 `openModal()` 함수 구조로 모두 일괄 갈아끼우기 돌입.
2. **Phase 3: 사용자(User/Common) 잔여 모달 치환**
   - `ConfirmModal`, `GalleryViewerModal` 등 전역 모달 구조 전화.
   - 최종적으로 전체 프로젝트에서 프론트엔드 뒤로가기 생명주기가 단 하나의 아키텍처로 흐르는지 E2E 테스트 통합 완료 선언.

> _Phase 1 통합 결과 UX : 이제 버튼을 누르면 해시 파라미터가 깔끔하게 추가되며 팝업이 띄워지고, 뒷배경(대시보드) 라우팅 파괴 없이 브라우저 '뒤로가기' 클릭 한 번에 모달만 쏙 하고 사라집니다! 🎉_
