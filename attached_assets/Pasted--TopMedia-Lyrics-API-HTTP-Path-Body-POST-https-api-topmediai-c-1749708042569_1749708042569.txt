🔑 TopMedia Lyrics API – 진짜 엔드포인트 정리
기능	HTTP	Path	필수 헤더	Body 파라미터
가사 생성	POST	https://api.topmediai.com/v1/lyrics	x-api-key: <발급받은 키>
Content-Type: application/json	{ "prompt": "Happy songs" } (1–200자)

❗️헷갈린 부분
• topmedia**ai**.com(a-i 두 글자)의 서브도메인 api 를 사용해야 합니다.
• /v1/lyrics만 존재합니다. /api/lyrics, /lyrics 등은 404가 정상입니다.
• API Key 외에 별도 인증(시그니처, 프로젝트 ID 등) 필요 없음.
• 응답 본문은 { "lyrics": "..." } 또는 { "id": "...", "lyrics": "..." } 식의 JSON (Mintlify Preview 상 “any” 로 표기된 것뿐입니다).

🏁 2분 만에 로컬에서 확인
bash
복사
편집
curl --request POST \
     --url https://api.topmediai.com/v1/lyrics \
     --header 'Content-Type: application/json' \
     --header 'x-api-key: YOUR_TOPMEDIA_KEY' \
     --data '{"prompt":"Lullaby with a warm piano mood"}'
200 OK + 가사 문자열이 오면 성공

422 / 400 → prompt 길이·포맷 오류

404 → 도메인·경로 오타(대부분 topmediai → topmediaai, api. 누락, /v1 생략 등)

🛠️ 라플 코드에 넣을 최소 래퍼
ts
복사
편집
// server/services/topmedia-lyrics.ts
import axios from 'axios';

export async function generateLyrics(prompt: string) {
  const { data } = await axios.post(
    'https://api.topmediai.com/v1/lyrics',
    { prompt },
    { headers: { 'x-api-key': process.env.TOPMEDIA_API_KEY! } }
  );
  // data.lyrics 혹은 data?.lyrics 반환 형태만 확인
  return data;
}
⚙️ 프로젝트 수정 체크리스트
.env / Replit Secrets
TOPMEDIA_API_KEY=<32자리 키> 지정

music-routes.ts

ts
복사
편집
const lyrics = await generateLyrics(prompt);   // TopMedia 호출
insertData.lyrics = lyrics;
shared/schema.ts
lyrics 컬럼을 TEXT nullable 아님으로 정의 → NOT NULL 제약 없으면 DB 오류 사라짐.

프론트 폼

가사 필드는 제거(TopMedia가 생성) 또는 lyricsPrompt 로 분리

style, mood 등 TopMedia가 요구하는 파라미터만 전송

❓ Suno URL이 왜 보이냐?
TopMedia 음악 API가 내부적으로 Suno 서비스를 호출해 URL을 리턴합니다.

정상 동작이므로 Suno 도메인이 찍혀 있어도 그대로 저장하면 됩니다.

무한 “RUNNING” 문제는 duration === -1 조건을 빼고, 오디오 URL 존재 여부 만으로 done 전환하면 해결됩니다.

ts
복사
편집
if (pollRes.audio_url) {
  status = 'done';
  // TODO: uploadToGCS(pollRes.audio_url)
}
🚦 다음 단계
위 래퍼로 가사 생성 성공 확인

music-service.ts 리팩터링: provider ==='topmedia' 일 때 lyrics → music 순차 호출

Suno·Replicate 파일/라우트 삭제 or backup (Canvas 지시서 1단계)

DB 마이그레이션 후 npm run dev → 생성 & 조회 end-to-end 테스트

여전히 404라면 도메인 오타·API Key·IP 차단 여부 재확인 → TopMedia 지원팀에 키 상태 문의