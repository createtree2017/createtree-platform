âœ… Step 5. [íšŒì› ë“±ê¸‰ ìˆ˜ë™ ë³€ê²½ ê¸°ëŠ¥ + ê¶Œí•œ êµ¬ì¡° ë³´ì™„] ì‘ì—…ì§€ì‹œì„œ

ğŸ¯ ì‘ì—… ëª©í‘œ ìš”ì•½:
1. /admin/users/:id/role API ìƒì„± - íšŒì› ë“±ê¸‰(memberType) ìˆ˜ë™ ë³€ê²½ ê¸°ëŠ¥
2. ë“±ê¸‰ë³„ ê¶Œí•œ ì œí•œ ì ìš© (ë³¸ì¸ë³´ë‹¤ ë†’ì€ ë“±ê¸‰ì€ ìˆ˜ì • ë¶ˆê°€)
3. ì „ì²´ ë³´í˜¸ ë¼ìš°íŠ¸ êµ¬ì¡° ì¬ê²€í†  - ê²½ë¡œ ëª…ê³¼ ì—­í•  ì¼ì¹˜í™”
4. ëˆ„ë½ëœ ë¯¸ë“¤ì›¨ì–´ ë° ë³‘ì› ìì› ë³´í˜¸ ì¡°ê±´ ì ê²€Â·ì ìš©

---

ğŸ”– íšŒì› ë“±ê¸‰ ì„¤ëª… (memberType ê¸°ì¤€)
- superadmin (ì°½ì¡°AI ëŒ€í‘œ): ëª¨ë“  ë³‘ì›/íšŒì›/ì½˜í…ì¸  ê°œì… ê°€ëŠ¥, ê´€ë¦¬ì ë“±ê¸‰ ìˆ˜ì • ê°€ëŠ¥
- admin (ì°½ì¡°AI ì§ì›): ëª¨ë“  ë³‘ì›/íšŒì›/ì½˜í…ì¸  ê°œì… ê°€ëŠ¥ (ë‹¨, ê´€ë¦¬ì ë“±ê¸‰ ìˆ˜ì • ë¶ˆê°€)
- hospital_admin: ë³¸ì¸ ë³‘ì› ìì›ë§Œ ê´€ë¦¬ ê°€ëŠ¥
- membership: ìœ ë£Œ ë³‘ì› ê³ ê° (ê¸°ëŠ¥ ë¬´ì œí•œ)
- pro: ìœ ë£Œ ê°œì¸ íšŒì› (ê¸°ëŠ¥ ë¬´ì œí•œ)
- general: ë¬´ë£Œ ì‚¬ìš©ì (ê¸°ëŠ¥ ì¼ë¶€ ì œí•œ)

---

âœ… 1. ë“±ê¸‰ ë³€ê²½ API ìƒì„±
PATCH /admin/users/:id/role
Body:
{
  "memberType": "pro" | "membership" | "hospital_admin" | "admin" | "superadmin"
}

---

âœ… 2. ê¶Œí•œ ì²´í¬ ë¡œì§ êµ¬í˜„ ì˜ˆì‹œ (admin ì œí•œ í¬í•¨)

requireAdminOrSuperAdmin(req, res, next);

if (req.user.memberType === 'admin') {
  const forbidden = ['admin', 'superadmin'];
  if (forbidden.includes(targetUser.memberType)) {
    return res.status(403).json({ error: "ì´ ë“±ê¸‰ì€ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤." });
  }
  if (forbidden.includes(newMemberType)) {
    return res.status(403).json({ error: "ì´ ë“±ê¸‰ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤." });
  }
}

---

âœ… 3. ì‘ë‹µ ì˜ˆì‹œ
{
  "success": true,
  "message": "íšŒì› ë“±ê¸‰ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "data": {
    "userId": 102,
    "newMemberType": "hospital_admin"
  }
}

---

âš ï¸ 4. ê¶Œí•œ êµ¬ì¡° ë³´ì™„ í•„ìˆ˜ í•­ëª© (ê°•ì œ ì ìš© ì§€ì‹œ)

A. /admin/** vs /hospital/** ê²½ë¡œ ë¶„ë¦¬
- /admin/** â†’ superadmin ë˜ëŠ” adminë§Œ ì ‘ê·¼
- /hospital/** â†’ hospital_admin ì „ìš©
- ì˜ˆì‹œ ì˜¤ë¥˜: router.get('/admin/campaign-applications', requireHospitalAdmin, ...) âŒ

B. ê´€ë¦¬ì ë³´í˜¸ ë¼ìš°íŠ¸ì— requireAdminOrSuperAdmin ë¯¸ë“¤ì›¨ì–´ ëˆ„ë½ ì—¬ë¶€ ì „ìˆ˜ í™•ì¸
- JWT ì—†ì´ ì ‘ê·¼ ì‹œ 401
- ê´€ë¦¬ì ì™¸ ì ‘ê·¼ ì‹œ 403

C. ë³‘ì› ìì› ë³´í˜¸ ì¡°ê±´ ì ê²€
- ëª¨ë“  ë³‘ì› ê´€ë¦¬ììš© ë¼ìš°íŠ¸ì—ì„œ ë‹¤ìŒ ì¡°ê±´ í•„ìˆ˜:
  if (resource.hospitalId !== req.user.hospitalId) {
    return res.status(403).json({ error: "ë³‘ì› ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤" });
  }

D. ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ ëˆ„ë½ ì „ìˆ˜ ì ê²€
- requireAuth ë˜ëŠ” requireHospitalAdminì´ ëˆ„ë½ëœ ë¼ìš°íŠ¸ê°€ ìˆëŠ”ì§€ routes.ts ì „ì²´ ê²€ì‚¬ í›„ ë³´ì™„

---

ğŸ“Œ ì™„ë£Œ ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸
- ì¼ë°˜ ê´€ë¦¬ìê°€ superadmin ë“±ê¸‰ ìˆ˜ì • ì‹œë„ â†’ 403 ë°˜í™˜
- hospital_adminì´ /admin/** ì ‘ê·¼ â†’ 403 ë°˜í™˜
- ë³‘ì›ê´€ë¦¬ìê°€ íƒ€ ë³‘ì› ìì› ì ‘ê·¼ â†’ 403 ë°˜í™˜
- ëª¨ë“  ë³´í˜¸ ë¼ìš°íŠ¸ â†’ JWT ì—†ì´ ì ‘ê·¼ ì‹œ 401 ë°˜í™˜
- ë“±ê¸‰ ìˆ˜ì • API â†’ PATCH ë™ì‘, memberType ë³€ê²½ë¨
