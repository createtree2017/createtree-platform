## ğŸ› ï¸ 1ë‹¨ê³„ â€‘ TopMediai êµ¬ì¡° ì „í™˜ *ë¼í”Œ ì‘ì—…ì§€ì‹œì„œ*

> **ëª©í‘œ**Â : Replicate/Suno ë¶„ê¸°ë¥¼ ì œê±°í•˜ê³  TopMediai ì „ìš© êµ¬ì¡°ë¡œ ë¦¬íŒ©í† ë§í•˜ë©°, í•„ìš”í•œ í•„ë“œÂ·í‚¤Â·ëª¨ë“ˆì„ ì‚¬ì „ ì •ë¦¬í•œë‹¤.

---

### 1. ì‚­ì œ(ë˜ëŠ” ë°±ì—…) ëŒ€ìƒ

| ê²½ë¡œ                                | ì¡°ì¹˜                   | ì‚¬ìœ                             |
| --------------------------------- | -------------------- | ----------------------------- |
| `server/services/suno-service.ts` | **ì‚­ì œ**               | ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” Puppeteer ìë™í™” ì½”ë“œ |
| `server/routes/suno-routes.ts`    | **ì‚­ì œ**               | Suno ì „ìš© API ì—”ë“œí¬ì¸íŠ¸ ë¶ˆí•„ìš”         |
| `client/src/pages/suno-music.tsx` | **ì‚­ì œ**               | Suno UI í˜ì´ì§€ ì œê±°                |
| `server/services/replicate.ts`    | **backup/** ë””ë ‰í„°ë¦¬ë¡œ ì´ë™ | ì¶”í›„ ì—°êµ¬ìš© ë³´ê´€, ëŸ°íƒ€ì„ í˜¸ì¶œ ê¸ˆì§€          |

> ```bash
> # ì˜ˆì‹œ ëª…ë ¹
> mv server/services/replicate.ts backup/replicate.ts.bak
> rm server/services/suno-service.ts server/routes/suno-routes.ts client/src/pages/suno-music.tsx
> ```

---

### 2. ìˆ˜ì • ëŒ€ìƒ íŒŒì¼

| ê²½ë¡œ                                          | í•µì‹¬ ë³€ê²½ ì                                                                                                                                                                              |
| ------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `shared/schema.ts`                          | `music` í…Œì´ë¸”ì— **provider, credit\_used, status, hospital\_id** í•„ë“œ ì¶”ê°€                                                                                                                 |
| `server/services/music-service.ts`          | <br>1ï¸âƒ£ ê¸°ì¡´ Suno/Replicate ë¶„ê¸° **ì „ë¶€ ì£¼ì„ì²˜ë¦¬**<br>2ï¸âƒ£ `provider === 'topmedia'` ë¡œì§ ì¶”ê°€<br>3ï¸âƒ£ TopMedia í˜¸ì¶œ í•¨ìˆ˜(`generateTopMediaMusic`) ì‚¬ìš©<br>4ï¸âƒ£ ì‘ë‹µê°’ì— `provider`, `creditUsed`, `status` ì €ì¥ |
| `client/src/components/music/MusicForm.tsx` | <br>â€¢ `provider` hidden input ê°’ `topmedia` ê³ ì •<br>â€¢ ìŠ¤íƒ€ì¼Â·ê°€ì‚¬ í•„ë“œ â†’ TopMedia íŒŒë¼ë¯¸í„° ì´ë¦„ ë§ì¶° ì „ì†¡                                                                                               |
| `client/src/pages/music.tsx`                | ë©”ë‰´/ë¼ìš°íŒ…ì—ì„œ Suno ì˜µì…˜ ì œê±°                                                                                                                                                                 |
| `.env` `replit.secrets`                     | `TOPMEDIA_API_KEY=your_key_here` ì¶”ê°€                                                                                                                                                 |

---

### 3. ì‹ ê·œ íŒŒì¼ ìƒì„±

| íŒŒì¼                                    | ë‚´ìš©                                      |
| ------------------------------------- | --------------------------------------- |
| `server/services/topmedia-service.ts` | TopMediai REST í˜¸ì¶œ ë˜í¼ (POSTÂ `/v1/music`) |

> ê¸°ë³¸ ìŠ¤ì¼ˆë ˆí†¤:
>
> ```ts
> import axios from "axios";
>
> export async function generateTopMediaMusic(params:{
>   title:string; prompt:string; lyrics?:string; instrumental:boolean;
> }){
>   const { data } = await axios.post("https://api.topmedia.ai/v1/music", params, {
>     headers:{ "x-api-key": process.env.TOPMEDIA_API_KEY! }
>   });
>   return data; // { url, duration, ... }
> }
> ```

---

### 4. GCS ì—…ë¡œë“œ TODO (ì£¼ì„ ì‚½ì…)

* `music-service.ts` ë‚´ë¶€ **// TODO: uploadToGCS(audioUrl)** ìœ„ì¹˜ í‘œì‹œ
* ì´í›„ 4ë‹¨ê³„ì—ì„œ `gcsUploader.uploadAudio()` êµ¬í˜„ ì˜ˆì •

---

### 5. í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

1. **`npm run dev`** ì¬ì‹œì‘ â†’ ì»´íŒŒì¼ ì˜¤ë¥˜ ì—†ì„ ê²ƒ
2. POSTÂ `/api/music/generate`Â â†’ TopMedia ì‘ë‹µ OK
3. DBÂ `music` ë ˆì½”ë“œÂ â†’ `provider='topmedia'`,Â `status='done'` ì €ì¥ í™•ì¸
4. ë³‘ì› ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸ â†’ ìê¸° ë³‘ì› ìŒì•…ë§Œ ì¡°íšŒ

---

### 6. ìˆœì„œ ìš”ì•½ (ë¼í”Œ ì‹¤í–‰ ì»¤ë§¨ë“œ)

1. â–¼ ì‚­ì œ/ë°±ì—… ëª…ë ¹ ì‹¤í–‰
2. â–¼ `topmedia-service.ts` ìƒì„± í›„ ì½”ë“œ ì‚½ì…
3. â–¼ `music-service.ts` ìˆ˜ì • (ë¶„ê¸° ë° TODO í¬í•¨)
4. â–¼ í”„ë¡ íŠ¸ì—”ë“œ í¼/í˜ì´ì§€ ìˆ˜ì •
5. â–¼ `.env`ì— `TOPMEDIA_API_KEY` ì…ë ¥
6. `npm run dev`Â â†’ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ìˆ˜í–‰

> âš ï¸ **ëª¨ë“  ì»¤ë°‹ ì „ `prettier --write` ì‹¤í–‰**í•˜ì—¬ ì½”ë”©ì»¨ë²¤ì…˜ ì¤€ìˆ˜
