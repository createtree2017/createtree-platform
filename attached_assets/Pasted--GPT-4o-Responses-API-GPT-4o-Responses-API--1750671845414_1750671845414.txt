âœ… [ë¼í”Œì´ ì „ìš©] GPT-4o + Responses API ëª¨ë¸ ë³€ê²½ ì‘ì—…ì§€ì‹œì„œ
ì‘ì—… ëª©ì : ê¸°ì¡´ ìˆ˜ì‘ì—… í”„ë¡¬í”„íŠ¸ ì¡°ë¦½ ë°©ì‹ â†’ GPT-4o Responses API ê¸°ë°˜ ìë™í™” ë°©ì‹ìœ¼ë¡œ ì „í™˜

ğŸ§© 1. ê°œìš”
ê¸°ì¡´ ë°©ì‹ì€ ì‚¬ìš©ìê°€ ì˜¬ë¦° ì´ë¯¸ì§€ì— ëŒ€í•´ style + variablesë¥¼ ì¡°í•©í•´ ì§ì ‘ í”„ë¡¬í”„íŠ¸ë¥¼ ì‘ì„±í•œ í›„ gpt-image-1 í˜¸ì¶œ

í•˜ì§€ë§Œ, ì–¼êµ´ ìœ ì‚¬ë„ ë° ìì—°ìŠ¤ëŸ¬ìš´ ë¬¸ì¥ êµ¬ì¡°ê°€ ë¶€ì¡±í–ˆìŒ

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ OpenAIì˜ GPT-4o + Responses APIë¥¼ ë„ì…í•˜ì—¬ ìë™í™”ëœ í”„ë¡¬í”„íŠ¸ ìƒì„± êµ¬ì¡°ë¡œ ì „í™˜í•¨

âš™ï¸ 2. ì‘ì—… íë¦„ ìš”ì•½
css
ë³µì‚¬
í¸ì§‘
[ì‚¬ìš©ì ì´ë¯¸ì§€ ì—…ë¡œë“œ + ìŠ¤íƒ€ì¼ + ë³€ìˆ˜]
   â†“
[GPT-4o Responses API í˜¸ì¶œ]
   â†’ ì´ë¯¸ì§€ ë¶„ì„ + ìŠ¤íƒ€ì¼/ë³€ìˆ˜ ë°˜ì˜ + ì˜ì–´ í”„ë¡¬í”„íŠ¸ ìë™ ìƒì„±
   â†“
[gpt-image-1 í˜¸ì¶œ]
   â†’ ì´ë¯¸ì§€ ìƒì„± ê²°ê³¼ base64ë¡œ ìˆ˜ì‹ 
   â†“
[GCS ì—…ë¡œë“œ + DB ì €ì¥ + í”„ë¡ íŠ¸ ì „ë‹¬]
ğŸ§¾ 3. API Key / í™˜ê²½ ì •ë³´
í•­ëª©	ë‚´ìš©
API Key	sk-proj-xxxxxxxxxxxxxxxxx í˜•ì‹ (âœ… Responses API ì‚¬ìš© ê°€ëŠ¥ í™•ì¸ë¨)
Project ìƒíƒœ	Playgroundì—ì„œ Responses API ì„ íƒ ê°€ëŠ¥ (í™œì„±í™” í™•ì¸ ì™„ë£Œ)
ì‚¬ìš© ëª¨ë¸	gpt-4o + gpt-image-1
ê¸°ëŠ¥ í™œì„±í™”	GPT-4o, Vision, Assistants API ëª¨ë‘ Enable ìƒíƒœ

ğŸ“¥ 4. ì…ë ¥ê°’ ëª…ì„¸
API ì—”ë“œí¬ì¸íŠ¸: POST /api/images/gpt4o-agent

ìš”ì²­ í˜•ì‹: multipart/form-data

ì „ë‹¬ ë°ì´í„°:

í•„ë“œ	í˜•ì‹	ì„¤ëª…
file	image	ì‚¬ìš©ì ì‚¬ì§„ (Buffer)
styleId	string	ì˜ˆ: "ghibli-watercolor"
variables	stringified JSON	ì˜ˆ: {"nickname": "ì½©ì•Œì´", "dueDate": "2025-09-01"}

ğŸ§  5. GPT-4o Responses API ìš”ì²­ ë°©ì‹
ts
ë³µì‚¬
í¸ì§‘
// requestGpt4oAgent.ts
export async function requestGpt4oAgent(imageBuffer: Buffer, styleText: string, variables: Record<string, string>): Promise<string> {
  const form = new FormData();

  // íŒŒì¼ ì—…ë¡œë“œ
  form.append("image", imageBuffer, "user.png");

  // í”„ë¡¬í”„íŠ¸ ì§€ì‹œì–´ êµ¬ì„±
  const variableText = Object.entries(variables)
    .map(([key, val]) => `- ${key}: ${val}`)
    .join("\\n");

  const instructions = `ì´ ì¸ë¬¼ì˜ íŠ¹ì§•ì„ ë°˜ì˜í•´ gpt-image-1ì— ì „ë‹¬í•  ì˜ì–´ í”„ë¡¬í”„íŠ¸ë¥¼ ë§Œë“¤ì–´ì¤˜:\\nìŠ¤íƒ€ì¼: ${styleText}\\në³€ìˆ˜:\\n${variableText}`;

  form.append("instructions", instructions);

  const response = await fetch("https://api.openai.com/v1/threads/THREAD_ID/runs", {
    method: "POST",
    headers: {
      Authorization: `Bearer ${process.env.OPENAI_API_KEY}`,
    },
    body: form,
  });

  const result = await response.json();
  return result?.prompt || "";
}
â— ì°¸ê³ : ì‹¤ì œ ìš´ì˜ ì‹œ THREAD_IDëŠ” ì‚¬ì „ ìƒì„± or ì„ì‹œ thread ìƒì„±ë¶€í„° ì´ì–´ì§€ëŠ” êµ¬ì¡°ë¡œ ê°œë°œ ê°€ëŠ¥

ğŸ–¼ï¸ 6. ì´ë¯¸ì§€ ìƒì„± ì²˜ë¦¬ (generateImage.ts)
ts
ë³µì‚¬
í¸ì§‘
export async function generateImage(prompt: string): Promise<string[]> {
  const response = await fetch("https://api.openai.com/v1/images/generations", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: `Bearer ${process.env.OPENAI_API_KEY}`,
    },
    body: JSON.stringify({
      model: "gpt-image-1",
      prompt,
      n: 1,
      size: "1024x1024",
      response_format: "b64_json",
    }),
  });

  const result = await response.json();
  return result.data.map((item: any) => `data:image/png;base64,${item.b64_json}`);
}
