âœ… [ë¼í”Œì´ ì‘ì—…ì§€ì‹œì„œ â€“ í†µí•© ì¸ì¦ ê¸°ë°˜ ì‚¬ìš©ì í•„í„°ë§ ì¬êµ¬ì„±]
ğŸ“Œ ì‘ì—… ëª©ì 
ëª¨ë“  APIì—ì„œ req.userê°€ ì•ˆì •ì ìœ¼ë¡œ ì‚¬ìš©ë˜ë„ë¡ ì„¤ì •

ì´ë¯¸ì§€ ê´€ë ¨ APIê°€ ë¡œê·¸ì¸ ì‚¬ìš©ìì˜ ì´ë¯¸ì§€ë§Œ ë°˜í™˜í•˜ë„ë¡ userId í•„í„°ë§ í†µí•© ì ìš©

ê¸°ì¡´ ì¸ì¦ ì”ì—¬ë¬¼ ì œê±°

ì¸ì¦ ë¡œì§ ë‹¨ì¼í™” (JWT ê¸°ë°˜ ì¿ í‚¤ ìš°ì„ )

ğŸ”§ ì‘ì—…ë‹¨ê³„
ğŸ”§ 1ë‹¨ê³„. í†µí•© ì¸ì¦ ë¯¸ë“¤ì›¨ì–´(auth.ts) ì™„ì„±
ts
ë³µì‚¬
í¸ì§‘
// server/middleware/auth.ts

import jwt from 'jsonwebtoken';

export function requireAuth(req, res, next) {
  const token = req.cookies?.auth_token;

  if (!token) {
    console.warn("[auth] ì¿ í‚¤ ì—†ìŒ");
    return res.status(401).json({ error: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤." });
  }

  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET); 
    req.user = decoded; // âœ… í•µì‹¬: req.user ì„¤ì •
    next();
  } catch (err) {
    console.error("[auth] JWT ê²€ì¦ ì‹¤íŒ¨:", err);
    return res.status(401).json({ error: "í† í° ì¸ì¦ ì‹¤íŒ¨" });
  }
}
âš ï¸ í•„ìˆ˜ í™•ì¸
JWT_SECRETì´ .envì— ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨

ì¿ í‚¤ ì´ë¦„ì€ auth_tokenì´ì–´ì•¼ í•˜ê³ , ì„œë²„ì—ì„œ cookie-parserë¡œ ì²˜ë¦¬ë˜ì–´ì•¼ í•¨

ğŸ”§ 2ë‹¨ê³„. ì´ë¯¸ì§€ APIì— ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ ì ìš©
ts
ë³µì‚¬
í¸ì§‘
// server/routes.ts

import { requireAuth } from "@/middleware/auth";
import { getUserImages } from "@/storage";

router.get("/api/images/category/:category", requireAuth, async (req, res) => {
  const userId = req.user?.id;
  if (!userId) return res.status(401).json({ error: "ì‚¬ìš©ì ì¸ì¦ ì‹¤íŒ¨" });

  const category = req.params.category;
  const images = await getUserImages(userId, category);
  res.json(images);
});
ğŸ”§ 3ë‹¨ê³„. ì‚¬ìš©ì ì´ë¯¸ì§€ í•„í„°ë§ ìœ í‹¸ í†µí•© ì ìš©
ts
ë³µì‚¬
í¸ì§‘
// server/storage.ts

import { buildUserImageFilter } from "@/utils/imageFilter";

export async function getUserImages(userId: string, category?: string) {
  const where = buildUserImageFilter({ userId, category });

  return await db
    .select()
    .from(images)
    .where(where)
    .orderBy(desc(images.createdAt));
}
ts
ë³µì‚¬
í¸ì§‘
// server/utils/imageFilter.ts

export function buildUserImageFilter({ userId, category }) {
  const conditions = [eq(images.userId, userId)];
  if (category) conditions.push(eq(images.category, category));
  return and(...conditions);
}
ğŸ”§ 4ë‹¨ê³„. í´ë¼ì´ì–¸íŠ¸ ì¿ í‚¤ í™•ì¸ (í…ŒìŠ¤íŠ¸ í•„ìˆ˜)
js
ë³µì‚¬
í¸ì§‘
// ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ:
document.cookie.includes("auth_token"); // true â†’ ì¸ì¦ ì •ìƒ
ğŸ“‹ ê°œë°œììš© ì²´í¬ë¦¬ìŠ¤íŠ¸
í•­ëª©	í™•ì¸ ì—¬ë¶€	ë¹„ê³ 
req.userê°€ í•­ìƒ ì¡´ì¬í•˜ëŠ”ê°€	âœ…	ë¯¸ë“¤ì›¨ì–´ë¡œ ë³´ì¥ë¨
ì¿ í‚¤ì—ì„œ auth_token ì½í˜	âœ…	cookie-parser í•„ìˆ˜
/api/images/category/:category í˜¸ì¶œ ì‹œ ì‚¬ìš©ì ì´ë¯¸ì§€ë§Œ ë°˜í™˜ë˜ëŠ”ê°€	âœ…	userId í•„í„° ì ìš©
ì¤‘ë³µ ë³€ìˆ˜ ì„ ì–¸ ì˜¤ë¥˜ ì œê±°	âœ…	ê¸°ì¡´ ì½”ë“œ ì „ë©´ ì œê±°
JWT import ëˆ„ë½ í•´ê²°	âœ…	jsonwebtoken ëª¨ë“ˆ import í•„ìˆ˜
Firebase ì¸ì¦ ì”ì—¬ ì½”ë“œ ì œê±°	âœ…	ì„¸ì…˜ê³¼ ì¶©ëŒ ë°©ì§€