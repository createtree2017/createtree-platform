1) { "error":"Test endpoints are disabled in production" }

원인
프로덕션에서 개발 전용 API(예: /api/test, /api/dev/*, mock 엔드포인트)를 호출하고 있습니다. 배포 환경에선 해당 라우트가 차단되어 JSON 에러를 돌려줍니다.

해결

프런트에서 API base를 환경별로 분리:

NEXT_PUBLIC_API_BASE(웹), API_BASE(서버)로 나눠 .env.development와 .env.production 값 구분

개발 전용 호출을 전부 if (process.env.NODE_ENV !== 'production') 또는 if (import.meta.env.DEV) 조건으로 감싸고, 프로덕션에선 실제 운영 API로 경로 전환

// api-client.ts
const API_BASE = process.env.NEXT_PUBLIC_API_BASE!;
export const getImage = (params) =>
  fetch(`${API_BASE}/images/generate`, { method: "POST", body: JSON.stringify(params) });

// 개발 전용 도구(예: /api/test/*)
if (process.env.NODE_ENV !== "production") {
  // dev-only tools...
}

2) Service Worker: Failed to execute 'put' on 'Cache': Request scheme 'chrome-extension' is unsupported

원인
sw.js의 fetch 핸들러가 모든 요청을 캐시에 넣으려다 chrome-extension:// 스킴까지 잡아서 터집니다. (확장프로그램 리소스는 캐시 불가)

해결 (필수 가드 추가)

http/https만 캐시

chrome-extension:, blob:, data:, file:, devtools: 등은 즉시 return

GET만 캐시, 그리고 /api/ 요청은 캐시 제외(SSR/API와 충돌 방지)

// sw.js (핵심만)
self.addEventListener('fetch', (event) => {
  const { request } = event;
  const url = new URL(request.url);

  // 1) 캐시 불가 스킴 필터
  const badSchemes = ['chrome-extension:', 'devtools:', 'blob:', 'data:', 'file:'];
  if (badSchemes.some(s => request.url.startsWith(s))) return;

  // 2) http/https만
  if (url.protocol !== 'http:' && url.protocol !== 'https:') return;

  // 3) POST/PUT 등은 패스
  if (request.method !== 'GET') return;

  // 4) API와 특정 경로 제외
  if (url.pathname.startsWith('/api/')) return;

  // 5) 그 외만 캐시 전략 적용 (networkFirst 등)
  event.respondWith(networkFirst(event));
});


배포 빌드에서만 SW를 등록하고 싶으면 if ('serviceWorker' in navigator && process.env.NODE_ENV === 'production')로 등록 위치도 가드해 주세요.

3) Failed to load resource: the server responded with a status of 403 (favicon.ico, index)

가능 원인 & 점검 항목

정적 파일 경로 문제: public/favicon.ico가 빌드 산출물에 포함되지 않거나, 배포 루트/리라이트 설정이 잘못됨

호스팅 규칙(Firebase/NGINX/Cloudflare 등)에서 경로가 인증 필요/차단으로 취급 → 403

Service Worker가 잘못된 응답을 리턴(위 2번 수정으로 대개 해결)

해결 체크리스트

정적 파일 위치: Next.js/프론트라면 public/favicon.ico에 위치(서브폴더 X).

호스팅 설정:

Firebase 예시

{
  "hosting": {
    "public": "out" /* or ".next", "dist" */,
    "ignore": ["**/.*", "**/node_modules/**"],
    "rewrites": [{ "source": "**", "destination": "/index.html" }],
    "headers": [
      { "source": "/favicon.ico", "headers": [{ "key": "Cache-Control", "value": "public, max-age=86400" }] }
    ]
  }
}


Nginx 예시: location = /favicon.ico { try_files /favicon.ico =204; }

SW 수정 후에도 계속 403이면, 브라우저에서 직접 /favicon.ico를 열어 실제 응답 코드와 헤더를 확인해 보세요. 404면 파일 누락, 403이면 호스팅/권한 문제입니다.

4) Cannot read properties of null (reading 'addEventListener') at share-modal.js:1:135

원인
document.querySelector(...)가 요소를 찾지 못했는데 바로 addEventListener를 호출. 배포 번들에서 DOM 구조 차이나 로드 타이밍으로 빈 값이 나옵니다.

해결

// share-modal.js
const btn = document.querySelector('[data-share-open]');
if (btn) {
  btn.addEventListener('click', openShare);
}
// 또는 DOMContentLoaded 보장
document.addEventListener('DOMContentLoaded', () => {
  const btn = document.querySelector('[data-share-open]');
  if (btn) btn.addEventListener('click', openShare);
});


SSR/CSR 혼용이라면 해당 스크립트는 클라이언트 사이드에서만 실행하도록 분기(useEffect, defer, type="module" + 하단 로드 등).

추가로 권장하는 배포 전 점검 스크립트

환경변수 검증

['NEXT_PUBLIC_API_BASE', 'OPENAI_API_KEY' /* ... */].forEach((k) => {
  if (!process.env[k]) console.warn(`[warn] missing env: ${k}`);
});


서비스워커 빌드 분기

개발에선 SW 비활성화(디버깅 편의)

프로덕션에서만 등록

/api 호출 로깅(프로덕션)

최초 진입 시 어떤 엔드포인트를 부르는지 콘솔/서버 로그로 확인

dev-only 엔드포인트가 남아있으면 즉시 눈에 띕니다